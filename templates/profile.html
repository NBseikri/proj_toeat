{% extends 'base.html' %}
{% block content %}

{% if 'user_id' in session and session['user_id'] != None %}
    <h1>Welcome, {{ user.first_name }}!</h1>
        <div class="add_rest">
            <h2 id="add_rest_header">Add a Restaurant to your To-eat List</h2>
                <form action="/profile/<user_id>" method="POST" id="tracking_form">
                    Search for a Restaurant! <input id="searchTextField" type="text" name="search"><br>
                    Include a To-eat List Note: <input id="tracking_note" type="text" name="tracking_note"><br><br>
                    <input type="submit" value="Add Restaurant"></form>

                <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key={{ key }}&libraries=places"></script>

                <script>
                    var input = document.getElementById('searchTextField');
                    var defaultBounds = new google.maps.LatLngBounds(
                        new google.maps.LatLng(85, -180), 
                        new google.maps.LatLng(-85, 180));
                    var options = {
                        bounds: defaultBounds,
                        types: ['establishment']
                    };
                    var autocomplete = new google.maps.places.Autocomplete(input, options);
                    autocomplete.addListener('place_changed', getDetails);
                    function getDetails() {
                        // Get the place details from the autocomplete object.
                        var place = autocomplete.getPlace();
                    }
                </script>

<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
                <script>
                    "use strict";
                    $(document).ready(function(){
                            $("#tracking_form").hide();
                        });

                    function toggleDiv() {
                       $("#tracking_form").toggle();
                    }

                    $("#add_rest_header").on('click', toggleDiv);
                </script>

        <div class='rest_details'>
            <h2 id="list_header">Your To-eat List Restaurants</h2>
            <div id="rest_list">
            {% if user.trackings|length > 0 %}
                {% set count = 0 %}
                {% for tracking in user.trackings %}
                <div class='rest_photo'>
                    <img src="{{ tracking.restaurant.photo}}" width="100" height="100"></a></div>
                <a href="/tracking/{{ tracking.tracking_id }}">{{ tracking.restaurant.rest_name }}</a>
              <!--   <form action='/tracking{{ tracking.tracking_id}}' method='GET'
                <input type="hidden" value="{{ tracking }}" name="tracking" /> -->
                <!-- </form> -->
                <p>{{ rest_add[count] }}</p>
                    {% set count = count + 1 %}
                    {% if tracking.visited %}
                        <p>You've visited this restaurant.</p>
                    {% else %}
                        <p>This restaurant is on your To-eat List.</p>
                    {% endif %}
                {% endfor %}
            {% else %}
                <p>You don't have any restaurants in your To-eat List.</p>
            {% endif %}</div></div>
            <script>
                    "use strict";
                    $(document).ready(function(){
                        $("#rest_list").hide();
                    });

                    function toggleDiv() {
                       $("#rest_list").toggle();
                    }

                    $("#list_header").on('click', toggleDiv);
            </script>
        <div class='friend_details'>
            <h2 id="friend_header">To-eat List Friends</h2>
            <div id="friend_info">
            <div id="current_friends">
            <h4>Current Friends</h4>
            {% if friend_id_names|length > 0 %}
                {% for friend in friend_id_names %}
                    <a href="/public_profile/{{ friend[0] }}">{{ friend[1] }}</a><br>
                {% endfor %}
            {% else %}
                <p>You don't have any To-eat List friends yet.</p>
            {% endif %}</div>
            <div id="sugg_friends">
            <h4>Suggested Friends</h4>
            {% if sugg_id_names|length > 0 %}
                {% for sugg in sugg_id_names %}
                <form action="/profile/<user_id>" method="POST" id="sugg_add">
                    <input type="submit" value="{{ sugg[1] }}">
                    <input type="hidden" name="add_id" value="Add {{ sugg[0] }}">
                </form>
                {% endfor %}
            {% else %}
                <p>We don't have any friends to suggest at this time.</p>
            {% endif %}</div>
            <div id="pend_friends">
            <h4>Friend Requests</h4>
            {% if pend_id_names|length > 0 %}
                {% for pend in pend_id_names %}
                <form action="/accept_friend" method="GET" id="acceptance">
                    <input type="hidden" name="accept_id" value="{{ pend[0] }}">
                    <input type="hidden" name="accept_name" value="{{ pend[1] }}">
                    <input type="submit" value="Accept {{ pend[1] }}">
                </form>
                {% endfor %}
            {% else %}
                <p>You do not have any friend requests at this time.</p>
            {% endif %}</div></div>
            <script>
                    "use strict";
                    //Hiding and toggling divs

                    $(document).ready(function(){
                        $("#friend_info").hide();
                    });

                    function toggleDiv() {
                       $("#friend_info").toggle();
                    }

                    $("#friend_header").on('click', toggleDiv);

                    //Accepting a friend request

                    // function showAcceptance(result) {
                    //     $('#friend_profile').html(result);
                    // }

                    // function submitAcceptance(evt) {
                    //     evt.preventDefault();

                    //     var formInputs = {
                    //         "accept_id": $("#accept_id").val(),
                    //         "accept_name": $("#accept_name").val()
                    //     };

                    //     $.post("/accept_friend", 
                    //            submitAcceptance,
                    //            showAcceptance
                    //            );
                    // }

                    // $("#acceptance").on("submit", submitOrder);
            </script>
{% else %}
    <a id='login_link' href="/login">Please login.</a>
{% endif %}

{% endblock %}