{% extends 'base.html' %}
{% block content %}

{% if 'user_id' in session and session['user_id'] != None %}
    {% if session['user_id'] %}
        <a href="/logout">Logout</a><br>
    {% endif %}
<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
    <h1>Welcome, {{ user.first_name }}!</h1>
        <div class="add_rest">
            <h2 id="add_rest_header">Add a Restaurant to your To-eat List</h2>
                <form action="/profile/<user_id>" method="POST" id="tracking_form">
                    Search for a Restaurant 
                        <input id="searchTextField" type="text" name="search"><br>
                    Have you visited this restaurant?<br> 
                        <input type="radio" name="yes" value="yes" id="yes">Yes
                        <input type="radio" name="no" value="no" id="no">No<br>
                        <div id="track">
                            Include a To-eat List Note: <input id="tracking_note" type="text" name="tracking_note">
                            <input type="submit" id="submit" value="Add Restaurant">
                        </div>
                        <div id="review">
                            Add a Review: <input id="tracking_review" type="text" name="tracking_review"
                               cols="40" 
                               rows="5" 
                               style="width:400px; height:50px;">
                               <input type="submit" id="submit" value="Add Restaurant">
                        </div><br>
                </form>
                    <script>
                    "use strict";
                    $(document).ready(function(){
                        $("#track").hide();
                    });

                    function toggleTrackingNote() {
                       $("#track").toggle();
                       if ($("#yes").attr("disabled") === 'disabled') {
                        $("#yes").attr("disabled", false);
                    }
                    else {
                        $("#yes").attr("disabled", true);
                       }
                    }

                    $("#no").on('click', toggleTrackingNote);

                    $(document).ready(function(){
                        $("#review").hide();
                    });

                    function toggleReview() {
                       $("#review").toggle();
                    if ($("#no").attr("disabled") === 'disabled') {
                        $("#no").attr("disabled", false);
                    }
                    else {
                        $("#no").attr("disabled", true);
                       }
                    }

                    $("#yes").on('click', toggleReview);
                    </script>

                <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key={{ key }}&libraries=places"></script>

                <script>
                    var input = document.getElementById('searchTextField');
                    var defaultBounds = new google.maps.LatLngBounds(
                        new google.maps.LatLng(85, -180), 
                        new google.maps.LatLng(-85, 180));
                    var options = {
                        bounds: defaultBounds,
                        types: ['establishment']
                    };
                    var autocomplete = new google.maps.places.Autocomplete(input, options);
                    autocomplete.addListener('place_changed', getDetails);
                    function getDetails() {
                        // Get the place details from the autocomplete object.
                        var place = autocomplete.getPlace();
                    }
                </script>
                <script>
                    "use strict";
                    $(document).ready(function(){
                            $("#tracking_form").hide();
                        });

                    function toggleDiv() {
                       $("#tracking_form").toggle();
                    }

                    $("#add_rest_header").on('click', toggleDiv);
                </script>

                <div class='rest_details'>
                <!-- Div for all restaurant related info -->
                    <h2 id="list_header">Your To-eat List Restaurants</h2>
                    <!-- Div for form and original_list -->
                        <div id="rest_list">
                        <!-- Div for form -->
                            <div id="filter_list">
                                <p>Filter By:</p>
                                    <form action="/filter_rest" method="GET" id="filter_form">
                                        <select id="filter_select">
                                            <option value="visited">Visited</option>
                                            <option value="not_visited">To-eat</option>
                                        </select>
                                        <input type="submit" value="Filter"></input>
                                    </form>
                                <br><br>
                            </div>
                            <!-- Closes #filter_list div -->
                            <div id="sort_list">
                                <p>Sort By:</p>
                                    <form action="/sort_rest" method="GET" id="sort_form">
                                        <select id="sort_select">
                                            <option value="low_price">Price: Low to High</option>
                                            <option value="high_price">Price: High to Low</option>
                                            <option value="low_rating">Rating: Low to High</option>
                                            <option value="high_rating">Ratings: High to Low</option>
                                        </select>
                                        <input type="submit" value="Sort"></input>
                                    </form>
                                <br><br>
                            </div>
                        
                            <div id="original_rest">
                            <!-- Div for original_rest -->
                                {% if user.trackings|length > 0 %}
                                {% set count = 0 %}
                                {% for tracking in user.trackings %}
                                    <div class='rest_photo'><img src="{{ tracking.restaurant.photo}}" width="100" height="100"></a></div>
                                    <a href="/tracking/{{ tracking.tracking_id }}">{{ tracking.restaurant.rest_name }}</a>
<!--                                     <p>{{ rest_add[count] }}</p> -->
                                {% set count = count + 1 %}
                                {% if tracking.visited %}
                                    <p>You've eaten here.</p>
                                {% else %}
                                    <p>On your To-eat List.</p>
                                {% endif %}
                                {% endfor %}
                                {% else %}
                                    <p>You don't have any restaurants in your To-eat List.</p>
                                {% endif %}
                            </div>
                            <!-- Closes original_rest div -->
                        </div>
                        <!-- Closes rest_list div -->
                </div>
                <!-- Closes rest_details div -->
            <script>
                    "use strict";
                    $(document).ready(function(){
                        $("#rest_list").hide();
                    });

                    function toggleDiv() {
                       $("#rest_list").toggle();
                    }

                    $("#list_header").on('click', toggleDiv);

                    function showOrg(result) {
                        var data = result.data;
                        $("#original_rest").empty();
                        for (var i in data) {
                            var photo = data[i]['photo'];
                            var newPhotoHTML = ("<div class='rest_photo'><img src='" + photo + "'width='100' height='100'></a></div>");

                            var id = data[i]['tracking_id'];
                            var rest_name = data[i]['rest_name'];
                            var newLink = ("<a href=/tracking/" + id + ">" + rest_name + "</a>");


                            var visited = data[i]['visited'];
                            var newVisit = ("<p>" + visited +"</p>");

                            $( "#original_rest" ).append(newPhotoHTML, newLink, newVisit);

                        }
                    }

                    function orgRequest(evt) {
                        evt.preventDefault();
                        var formInputs = {
                            "filter" : $("#filter_select").val(),
                        };
                        $.get("/filter_rest",
                            formInputs, 
                            showOrg);
                    }

                    $("#filter_form").on("submit", orgRequest);


                    function sortRequest(evt){
                        evt.preventDefault();
                        console.log('HEYYYYYYYY!')
                        var sortInputs = {
                            "sort" : $("#sort_select").val(),
                        };
                        console.log(sortInputs["sort"])
                        $.get("/sort_rest"),
                            sortInputs,
                            showOrg;
                    }

                    $("#submit_form").on("sumbit", sortRequest);
            </script>
        <div class='friend_details'>
            <h2 id="friend_header">To-eat List Friends</h2>
            <div id="friend_info">
            
            <div id="current_friends">
            <h4>Current Friends</h4>
            {% if friend_id_names|length > 0 %}
                {% for friend in friend_id_names %}
                <form action="/friend_profile" method="GET">
                    <input type="hidden" name="friend_id" value="{{ friend[0] }}">
                    <input type="submit" value="{{ friend[1] }}">
                </form>
                {% endfor %}
            {% else %}
                <p>You don't have any To-eat List friends yet.</p>
            {% endif %}</div>
            <div id="pend_friends">
            <h4>Friend Requests</h4>
            {% if pend_id_names|length > 0 %}
                {% for pend in pend_id_names %}
                <form action="/accept_friend" method="GET">
                    <input type="hidden" name="accept_id" value="{{ pend[0] }}">
                    <input type="submit" value="Accept {{ pend[1] }}">
                </form>
                {% endfor %}
            {% else %}
                <p>You do not have any friend requests at this time.</p>
            {% endif %}
            </div>
            <div id="sugg_friends">
            <h4>Suggested Friends</h4>
            {% if sugg_id_names|length > 0 %}
                {% for sugg in sugg_id_names %}
                <form action="/request_friend" method="GET">
                    <input type="hidden" name="request_id" value="{{ sugg[0] }}">
                    <input type="submit" value="Add {{ sugg[1] }}">
                </form>
                {% endfor %}
            {% else %}
                <p>We don't have any friends to suggest at this time.</p>
            {% endif %}
            </div></div>
            <script>
                    "use strict";
                    //Hiding and toggling divs

                    $(document).ready(function(){
                        $("#friend_info").hide();
                    });

                    function toggleDiv() {
                       $("#friend_info").toggle();
                    }

                    $("#friend_header").on('click', toggleDiv);
            </script>
{% else %}
    <a id='login_link' href="/login">Please login.</a>
{% endif %}

{% endblock %}